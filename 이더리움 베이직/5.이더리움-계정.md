# 이더리움 계정(Ethereum Account)

## 목차

- [1. 이더리움 계정(Ethereum Account)이란?](#1-이더리움-계정ethereum-account이란)
- [2. 이더리움 계정의 유형](#2-이더리움-계정의-유형)
- [3. 이더리움 계정의 구조](#3-이더리움-계정의-구조)
- [4. 두 계정 유형의 차이점](#4-두-계정-유형의-차이점)
- [5. 외부 소유 계정의 개인 키와 공개 키](#5-외부-소유-계정의-개인-키와-공개-키)
- [6. 이더리움 계정의 생성 과정](#6-이더리움-계정의-생성-과정)
- [7. 요약](#7-요약)

## 1. 이더리움 계정(Ethereum Account)이란?

![DALL.E로 생성한 이더리움 계정 이미지](https://github.com/bohyunkang/road-to-bangkok/assets/65386533/8755f079-7921-4ccf-86e8-8b3e9adf2170)

**이더리움 계정은 이더 잔액이 있는 엔티티입니다.** 그러니까 이더리움 네트워크의 계정은 이더리움 트랜잭션을 이더리움 네트워크에 제출할 수 있는 이더(ETH) 잔고가 있는 엔티티라는 것입니다.

이더리움 네트워크에서 계정은 사용자가 제어하는 계정이거나 스마트 컨트랙트로 배포되는 계정이거나 둘 중 하나입니다. 이 두 가지 계정 유형은 아래에 더 자세히 설명하도록 하겠습니다.

## 2. 이더리움 계정의 유형

앞서 설명하였듯이 이더리움 계정의 유형은 두 가지입니다.

1. **외부 소유 계정(Externally-Owned Account; EOA)**

   외부 소유 계정은 개인 키가 있는 계정입니다. 즉, 해당 계정의 개인 키를 가진 사람만이 제어할 수 있습니다. 개인 키를 가진다는 건, 자금 또는 컨트랙트에 대한 접근을 제어할 수 있다는 뜻입니다.

2. **컨트랙트 계정(Contract Account; CA)**

   컨트랙트 계정은 외부 소유 계정과 달리 개인 키는 존재하지 않고, 대신 스마트 컨트랙트 코드가 존재하는 계정입니다. 스마트 컨트랙트 코드는 컨트랙트 계정 생성 시 이더리움 블록체인에 기록되고 EVM에 의해 실행되는 소프트웨어 프로그램을 의미합니다. 컨트랙트 계정은 해당 코드를 통해 제어됩니다.

두 계정 **모두 기본 이더리움 토큰인 이더를 수신, 보유 및 전송할 수 있습니다.** 이를 통해 사용자와 디앱(DApp)은 트랜잭션을 주고받을 수 있는 이더 잔고를 보유할 수 있습니다.

두번째로, **이 계정들은 블록체인의 스마트 컨트랙트와도 상호작용할 수 있습니다.** 이는 디앱이 네트워크상의 다른 디앱과 상호작용할 수 있을 뿐만 아니라 사용자들과도 상호작용할 수 있다는 것을 의미합니다. 이러한 디앱이 서로 상호작용할 수 있는 기능은 금융 부문에서 매우 유용할 수 있으며, 이 기능을 활용하는 많은 디앱이 배포되어 있습니다.

## 3. 이더리움 계정의 구조

![이더리움 계정의 구조 이미지](https://github.com/bohyunkang/road-to-bangkok/assets/65386533/8078b1a8-fbbf-4056-a2a9-f7baa23d58fa)
🔼 출처: https://info.etherscan.com/understanding-ethereum-accounts/

이더리움 계정에는 네 가지 필드가 있습니다.

- `nonce`
  - 논스(nonce)는 외부 소유 계정에서 전송된 트랜잭션 수 또는 컨트랙트 계정에서 생성된 컨트랙트 수를 나타내는 카운터입니다.
  - 외부 소유 계정일 경우, 해당 계정에서 성공적으로 전송한 트랜잭션의 수를 의미합니다.
  - 컨트랙트 계정일 경우, 생성된 컨트랙트의 수를 의미합니다.
  - 각 계정에 대해 주어진 논스를 가진 하나의 트랜잭션만 실행할 수 있으므로, 서명된 트랜잭션이 반복적으로 브로드캐스트되고 다시 실행되는 재생 공격으로부터 보호됩니다.
- `balance`
  - 잔액(balance)는 해당 계정이 보유한 Wei의 수입니다. 즉, 해당 계정이 보유하고 있는 이더의 양입니다.
  - Wei는 ETH의 가장 작은 단위로, 1 ETH는 1e+18 Wei와 같습니다.
- `storageRoot`
  - 스토리지 루트(storageRoot)는 스마트 컨트랙트에서만 사용하는 영구 데이터 저장소입니다. 자세히는 계정의 스토리지를 나타내는 머클 패트리샤 트리(Merkle Patricia Trie; MPT)의 루트 해시 값입니다. 트랜잭션 및 시스템 상태가 머클 패트리샤 트리라고 하는 시리얼라이즈된 해시 데이터 구조로, 트리는 스마트 컨트랙트의 저장소를 나타내는 키-값 쌍을 저장합니다.
  - 이더리움에서 트리(Trie)는 머클 패트리샤 트리라는 자료구조를 사용합니다.
    - 이 자료 구조는 이더리움의 데이터 저장 및 검색 메커니즘의 핵심 구성 요소입니다. 기본적으로 머클 트리(Merkle Tree)와 패트리샤 트리(Patricia Trie)의 장점을 결합하여 데이터를 저장하고 확인하는 안전한 방법을 제공합니다.
  - 때로는 스토리지 해시라고도 불립니다.
  - 컨트랙트 계정에서만 유효한 필드이며, 외부 소유 계정의 경우, `storageRoot` 필드는 빈 문자열의 해시입니다.
- `codeHash`
  - 코드해시(codeHash)는 이더리움 가상 머신(EVM)에 있는 컨트랙트 계정의 코드를 나타냅니다.
  - 컨트랙트 계정의 경우, 다양한 작업을 수행할 수 있는 코드가 프로그래밍되어 있습니다. 이 EVM 코드는 계정이 메시지 호출을 받으면 실행됩니다. 다른 계정 필드와 달리 변경할 수 없습니다. 이러한 모든 코드들은 나중에 검색할 수 있도록 해당 해시 아래 상태 데이터베이스에 포함되어 있습니다. 이 해시 값을 `codeHash`라고 합니다.
  - `storageRoot`와 같이 컨트랙트 계정에서만 유효한 필드이며, 외부 소유 계정의 경우, `codeHash` 필드는 빈 문자열의 해시입니다.

## 4. 두 계정 유형의 차이점

이렇게 계정 유형과 구조에 대해 알아봤으니 이번엔 이 두 계정의 차이점을 알아보겠습니다.

**외부 소유 계정은 계정의 개인 키에 액세스할 수 있는 사람이면 누구나 제어할 수 있습니다.** 사용자가 제어하는 계정을 외부 소유 계정이라고도 합니다.

- 이더스캔에서 외부 소유 계정은 아래 사진에서처럼 '**Address**'라고 표시되는 것을 확인할 수 있습니다.

![이더스캔에서 탐색한 외부 소유 계정](https://github.com/bohyunkang/road-to-bangkok/assets/65386533/71cd33a1-285a-4122-bee6-ae49d9bd68ca)
🔼 이더스캔에서 확인하기 👉 [링크](https://etherscan.io/address/0xab5801a7d398351b8be11c439e05c5b3259aec9b)

반면에 **컨트랙트 계정은 개인 키가 없지만 스마트 컨트랙트 코드의 로직에 의해 제어됩니다.**

- 이더스캔에서 컨트랙트 계정은 아래 사진에서처럼 '**Contract**'라고 표시되는 것을 확인할 수 있습니다.

![이더스캔에서 탐색한 컨트랙트 계정](https://github.com/bohyunkang/road-to-bangkok/assets/65386533/b6899b72-a574-477b-9ecf-facfbcf60508)
🔼 이더스캔에서 확인하기 👉 [링크](https://etherscan.io/address/0x68d30f47f19c07bccef4ac7fae2dc12fca3e0dc9)

둘째, **외부 소유 계정만 트랜잭션을 시작할 수 있습니다. 하지만, 컨트랙트 계정은 트랜잭션 수신에 대한 응답으로만 트랜잭션을 보낼 수 있습니다.**

셋째, **외부 소유 계정은 계정을 생성할 때 비용이 들지 않습니다.** 즉, 누구나 사용자 제어 계정을 만들 수 있으며, 시작하기 위해 비용을 지불하지 않고도 이더를 주고받을 수 있습니다. 하지만, 컨트랙트 계정은 그렇지 않습니다. 컨트랙트 계정은 블록체인에 배포된 스마트 컨트랙트이며 블록체인 리소스를 활용하므로, 컨트랙트 계정을 배포, 즉 생성하려면 네트워크의 노드가 확인하고 블록체인에 커밋해야 하는 네트워크 스토리지가 필요합니다. 이 과정이 필요하기 때문에 노드에 보상을 제공해야 합니다. 그렇기 때문에 **컨트랙트 계정을 생성하기 위해서는 비용을 지불해야 합니다.**

넷째, **컨트랙트 계정은 다양한 작업을 실행하는 트랜잭션을 만들거나 받을 수 있습니다.** 외부 소유 계정과 컨트랙트 계정의 마지막 주요 차이점은 스마트 컨트랙트에 내재된 기능입니다. 스마트 컨트랙트는 코드로 제어되기 때문에 코드를 트리거할 수 있는 트랜잭션을 만들거나 받을 수 있으며, 이를 통해 다른 컨트랙트 생성을 포함한 다양한 작업을 실행할 수 있습니다.

## 5. 외부 소유 계정의 개인 키와 공개 키

**이더리움의 계정은 개인 키(private key)와 공개 키(public key) 쌍으로 구성되어 있습니다.**

하지만 개인 키와 공개 키를 알아보기 전에 앞서, **이더리움 계정은 지갑이 아니라는 사실을 명확히 알아야 합니다.**

지갑은 사용자가 이더리움 계정과 상호작용할 수 있는 사용자 인터페이스 또는 애플리케이션입니다. 실제로 지갑에는 사용자가 여러 이더리움 계정을 생성할 수 있는 기능이 있는 경우가 많습니다. 그 때문에 지갑이 계정이라고 생각하는 경우가 종종 발생합니다. 하지만, 지갑은 계정이 아니라는 것을 명심해야 합니다.

그럼 이제 계정이 무엇인지 정의하기 위해 계정을 구성하는 내부 요소를 살펴봅시다.

먼저, **외부 소유 계정은 키 쌍으로 구성된 계정입니다. 키 쌍은 개인 키와 공개 키로 이루어진 암호화 키 쌍을 의미합니다.** 이 키 쌍은 네트워크에서 이루어진 거래가 계정 소유자가 서명했음을 증명하고 악의적인 활동을 방지하는 역할을 합니다.

**개인 키는 트랜잭션에 서명하는 데 사용되므로, 계정 내에 포함된 모든 자산은 이 개인 키의 관리 하에 있습니다.** 개인 키는 외부 소유 계정에서 매우 중요합니다. 그 이유는 계정이 보유한 자산이 실제로 계정 내에 있는 것이 아니기 때문입니다.

자산은 이더리움 블록체인의 분산 원장에 저장되며 계정 소유자가 보유한 개인 키에 묶여 있습니다. 때문에 개인 키는 절대로 타인과 공유해서는 안됩니다. 개인 키는 이름 그대로 개인 정보입니다! **개인 키를 보유한 사람은 개인 키와 관련된 모든 자산에 액세스할 수 있으므로 개인 키를 비공개로 유지하는 것이 매우 중요합니다.**

이와 반대로 **공개 키는 공유를 위한 것입니다. 계정 소유자가 트랜잭션을 수신하기 위해서는 공개 키가 필요합니다.** 이를 설명하기 위해 예를 들어보겠습니다.

```
보니는 브랜디에게 1 이더를 보내고 싶습니다.
브랜디에게 1 이더를 전송하는 트랜잭션을 생성하기 위해 보니는 아래 세 가지가 필요합니다.

1. 1 이더를 전송하는 이더리움 트랜잭션을 이더리움 네트워크상에 브로드캐스트하기 위해 자신의 이더리움 계정의 공개 키가 필요합니다.
2. 1 이더를 받는 브랜디의 이더리움 계정의 공개 키가 필요합니다.
3. 보니는 자신이 1 이더를 보내는 계정의 소유자임을 증명하기 위해 개인 키로 해당 트랜잭션에 서명해야 합니다.
```

**이러한 공개 키-개인 키 쌍 솔루션은 블록체인 네트워크에서 사기 행위를 방지하는 데 기여합니다.**

이더리움에서는 [타원 곡선 디지털 서명 알고리즘(ECDSA)](https://wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm)이 사용되어 공개 키와 개인 키가 생성됩니다. 이 알고리즘은 매우 강력한 암호화 기술을 바탕으로 하여 계정의 보안을 높입니다. **특히 개인 키 서명은 이더리움 트랜잭션의 위조를 방지하고, 공개 키 암호화는 수신자가 원래 의도한 수신자임을 보장합니다.**

## 6. 이더리움 계정의 생성 과정

계정을 생성하려는 경우, [ethers.js](https://docs.ethers.io/v5/api/signer/#creating-a-wallet) 또는 [web3.js](https://web3js.readthedocs.io/en/v1.3.4/web3-eth-accounts.html#create)와 같은 라이브러리를 사용해서 생성할 수 있습니다.

대부분의 라이브러리는 임의의 개인 키를 생성합니다. 이때 개인 키는 64개의 16진수 문자로 구성되며 비밀번호로 암호화할 수 있습니다.

- 예: `3f6d95efc3b25e63d8e3a9b7e8abda631e7d30b80e3d7c5f4b23a8d2bb7c95c1`

공개 키는 타원 곡선 디지털 서명 알고리즘(ECDSA)을 사용하여 개인 키에서 생성됩니다.

- 예: `044d10cd32bc6403d95e5c3456df3b12c4c9ec15fefbfbc7e83c02b8f8b69e67d92b7e40eae4e48cc3a32db0e3485891cf87e938f3e589c742af92e66c0bb45a73`

그렇게 생성된 공개 키의 Keccak-256 해시의 마지막 20바이트를 가져와서 `0x`시작 부분에 추가하면 계정의 공개 주소를 얻을 수 있습니다.

- 예: `0x0bda7b3d8af26a6a7f4e4d60c1274a12e01d87ab`

이게 바로 지갑 주소에 해당하는 것입니다.

이때, 개인 키에서 새로운 공개 키를 생성하는 것은 가능하지만, 공개 키로부터 개인 키를 역추적할 수는 없습니다. 때문에 개인 키는 절대로 보안이 유지되어야 하며, 이름에서 알 수 있듯이 개인(비밀)을 의미합니다.

## 7. 요약

이제 이번 챕터를 마치며, 배운 내용을 한번 요약하고 마무리하겠습니다.

<table>
  <thead>
    <tr>
      <th></th>
      <th>외부 소유 계정(EOA)</th>
      <th>컨트랙트 계정(CA)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="2">공통 기능</td>
      <td colspan="2">1. 이더를 전송, 수신, 보유할 수 있음: 이더 및 이더리움 기반 토큰만 거래 가능</td>
    </tr>
    <tr>
      <td colspan="2">2. 사용자 뿐만 아니라 네트워크상의 다른 디앱들과도 상호작용 가능</td>
    </tr>
    <tr>
      <td>컨트롤</td>
      <td>유저: 프라이빗 키</td>
      <td>스마트 컨트랙트 코드 로직</td>
    </tr>
    <tr>
      <td>트랜잭션 시작</td>
      <td>가능</td>
      <td>불가능</td>
    </tr>
    <tr>
      <td>계정 생성 비용</td>
      <td>무료</td>
      <td>유료 → 네트워크 스토리지 필요 및 네트워크 검토/블록체인 커밋</td>
    </tr>
    <tr>
      <td>스마트 컨트랙트 관련 기능</td>
      <td>X</td>
      <td>다양한 액션 트리거 가능(예: 새로운 컨트랙트 생성 등)</td>
    </tr>
    <tr>
      <td>구성 요소</td>
      <td>키 쌍<br>- 공개 키: 수신자 확인<br>- 개인 키: 거래 위조 방지</td>
      <td>X</td>
    </tr>
  </tbody>
</table>
